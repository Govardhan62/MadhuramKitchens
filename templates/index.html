{% extends 'demo.html' %}
{% load static %}
{% block content %}
  
    <!-- cuisine section by ram -->
<section class="ftco-section">
  <div class="container">
    <div class="row justify-content-center mb-5 pb-2">
      <div class="col-md-7 text-center heading-section ftco-animate">
        <span class="subheading">Cuisine</span>
        <h2 class="mb-4">Our Menu</h2>
      </div>
    </div>	
    <div class="row">
      {% for category in categories %}
      <div class="col-md-6 col-lg-3 ftco-animate">
        <div class="staff">
          <div class="img" style="background-image: url({{category.image.url}});"></div>
          <div class="text pt-4">
            <h3 style="text-align: center;">{{category.name}}</h3>           
          </div>
        </div>
      </div>
      {% endfor %}
    </div>
  </div>
</section>
<!-- cuisine section end by ram -->

<!-- menu section by ram -->
<section class="ftco-section">
  <div class="container-fluid px-4">
    <div class="row justify-content-center mb-5 pb-2">
      <div class="col-md-7 text-center heading-section ftco-animate">
        <span class="subheading">Specialties</span>
        <h2 class="mb-4">Our Menu</h2>
      </div>
    </div>
    <div class="row">
      {% csrf_token %}
  
          {% for category in categories %}
      <div class="col-md-6 col-lg-4 menu-wrap">
        <div class="heading-menu text-center ftco-animate">
          <h3>{{ category.name }}</h3>
        </div>
        {% for dish in menu_items %}
              {% if dish.category.id == category.id %}
        <div class="menus d-flex ftco-animate">
          <div
            class="menu-img img"
            style="background-image: url({{dish.image.url}})" 
          ></div>
          <div class="text">
            <div class="d-flex">
              <div class="one-half">
                <h3>{{ dish.dish_name }}</h3>
              </div>
              <div class="one-forth" style="cursor:pointer ;">
                <span class="price"  onclick="toggleSelect(this, '{{ dish.id }}')">  {% if dish.id|stringformat:"s" in request.session.bag %}
                   ✖
                  {% else %}
                   ✔
                  {% endif %}</span>
              </div>
            </div>
            <p>{{ dish.description|truncatewords_html:10 }}</p>
          </div>
        </div>
        {% endif %}
        {% endfor %}
      </div>
      {% endfor %}
    </div>
  </div>
</section>
    
    <!-- menu section end by ram -->

<!-- footer by ram -->
<footer class="ftco-footer ftco-bg-dark ftco-section">
  <div class="container-fluid px-md-5 px-3">
    <div class="row mb-5">
      <div class="col-md-6 col-lg-3">
        <div class="ftco-footer-widget mb-4">
          <!-- <h2 class="ftco-heading-2">MADHURAM</h2> -->
          <div style="text-align:center;padding-bottom: 30px;">
          <img src="static/images/madhuram-kitchens-logo.png" height="100" width=""/>
          </div>
          <p>
            Welcome to Madhuram's Kitchen, where flavors come alive! Nestled
            far away, behind the word mountains, we bring you the essence of
            culinary delights. Join us for an unforgettable dining
            experience!
          </p>
          <ul
            class="ftco-footer-social list-unstyled float-md-left float-lft mt-3"
          >
            <li class="ftco-animate">
              <a href="#"><span class="icon-twitter"></span></a>
            </li>
            <li class="ftco-animate">
              <a href="#"><span class="icon-facebook"></span></a>
            </li>
            <li class="ftco-animate">
              <a href="#"><span class="icon-instagram"></span></a>
            </li>
          </ul>
        </div>
      </div>
      <div class="col-md-6 col-lg-3">
        <div class="ftco-footer-widget mb-4">
          <h2 class="ftco-heading-2">Open Hours</h2>
          <ul class="list-unstyled open-hours">
            <li class="d-flex">
              <span>Monday</span><span>9:00 - 24:00</span>
            </li>
            <li class="d-flex">
              <span>Tuesday</span><span>9:00 - 24:00</span>
            </li>
            <li class="d-flex">
              <span>Wednesday</span><span>9:00 - 24:00</span>
            </li>
            <li class="d-flex">
              <span>Thursday</span><span>9:00 - 24:00</span>
            </li>
            <li class="d-flex">
              <span>Friday</span><span>9:00 - 02:00</span>
            </li>
            <li class="d-flex">
              <span>Saturday</span><span>9:00 - 02:00</span>
            </li>
            <li class="d-flex">
              <span>Sunday</span><span> 9:00 - 02:00</span>
            </li>
          </ul>
        </div>
      </div>
      <div class="col-md-6 col-lg-3">
        <div class="ftco-footer-widget mb-4">
          <h2 class="ftco-heading-2">Newsletter</h2>
          <p>
            Far away, behind the word mountains, far from the countries,
            lies a kitchen filled with flavors and delight. Subscribe for
            updates from Madhuram's Kitchen!
          </p>
          <form action="#" class="subscribe-form">
            <div class="form-group">
              <input
                type="text"
                class="form-control mb-2 text-center"
                placeholder="Enter email address"
              />
              <input
              style="background-color: #f57e20!important;"
                type="submit"
                value="Subscribe"
                class="form-control submit px-3"
              />
            </div>
          </form>
        </div>
      </div>
      <div class="col-md-6 col-lg-3">
        <div class="ftco-footer-widget mb-4">
          <h2 class="ftco-heading-2">Instagram</h2>
          <div class="thumb d-sm-flex">
            <a
              href="#"
              class="thumb-menu img"
              style="background-image: url(static/images/insta-1.jpg)"
            >
            </a>
            <a
              href="#"
              class="thumb-menu img"
              style="background-image: url(static/images/insta-2.jpg)"
            >
            </a>
            <a
              href="#"
              class="thumb-menu img"
              style="background-image: url(static/images/insta-3.jpg)"
            >
            </a>
          </div>
          <div class="thumb d-flex">
            <a
              href="#"
              class="thumb-menu img"
              style="background-image: url(static/images/insta-4.jpg)"
            >
            </a>
            <a
              href="#"
              class="thumb-menu img"
              style="background-image: url(static/images/insta-5.jpg)"
            >
            </a>
            <a
              href="#"
              class="thumb-menu img"
              style="background-image: url(static/images/insta-6.jpg)"
            >
            </a>
          </div>
        </div>
      </div>
    </div>
    <div class="row">
      <div class="col-md-12 text-center">
        <p>
          <!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
          Copyright &copy;
          <script>
            document.write(new Date().getFullYear());
          </script>
          All rights reserved
          <!-- All rights reserved | This template is made with
          <i class="icon-heart" aria-hidden="true"></i> by
          <a href="https://colorlib.com" target="_blank">Colorlib</a> -->
          <!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
        </p>
      </div>
    </div>
  </div>
</footer>
<!-- footer end by ram -->




   



    <!-- <script>
      function toggleSelect(button, dishId) {
        const csrfToken = document.querySelector('input[name="csrfmiddlewaretoken"]').value;
        const isSelected = button.classList.contains('selected');  // Check if item is already selected
        const action = isSelected ? 'unselected' : 'selected';  // Determine the action based on the current state
    
        // Make the fetch request to add or remove the dish from the bag
        fetch("{% url 'add_to_bag' %}", {
          method: 'POST',
          headers: {
            'X-CSRFToken': csrfToken,
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            'dish_id': dishId,
            'action': action
          })
        })
        .then(response => response.json())
        .then(data => {
          // Update the bag count in the UI
          document.querySelector('.bag-count').textContent = data.total_items_count;
    
          // Toggle the button text and styles based on the action
          if (action === 'selected') {
            button.textContent = 'Unselect ✖';  // Change button text to "Unselect"
            button.classList.add('selected');   // Add 'selected' class for styling
            button.classList.remove('unselected');  // Remove 'unselected' class
          } else {
            button.textContent = 'Select ✔';  // Change button text to "Select"
            button.classList.remove('selected');  // Remove 'selected' class
            button.classList.add('unselected');  // Add 'unselected' class for styling
          }
        })
        .catch(error => {
          console.error('Error:', error);
          alert('An error occurred. Please try again.');  // Handle errors with an alert or error display
        });
      }
    </script> -->

    <script>
      function toggleSelect(button, dishId) {
        const csrfToken = document.querySelector('input[name="csrfmiddlewaretoken"]').value;
        const isSelected = button.classList.contains('selected');
        const action = isSelected ? 'unselected' : 'selected';
    
        fetch("{% url 'add_to_bag' %}", {
          method: 'POST',
          headers: {
            'X-CSRFToken': csrfToken,
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            'dish_id': dishId,
            'action': action
          })
        })
          .then(response => response.json())
          .then(data => {
            // Update the bag count
            document.querySelector('.bag-count').textContent = data.total_items_count;
    
            // Toggle button text and classes
            if (action === 'selected') {
              button.textContent = '✖';
              button.classList.add('selected');
              button.classList.remove('unselected');
            } else {
              button.textContent = '✔';
              button.classList.remove('selected');
              button.classList.add('unselected');
            }
          })
          .catch(error => console.error('Error:', error));
      }
    </script>

    <!-- <div class="bag-icon-container">
      <a href="{% url 'view_bag' %}" class="bag-icon-link">
        <div class="bag-icon">
          <i class="fas fa-shopping-bag"></i>
          <span class="bag-count">{{ request.session.total_items_count|default:0 }}</span>
        </div>
      </a>
    </div> -->



    <script>
      document.querySelectorAll('.add-to-bag').forEach(button => {
        button.addEventListener('click', function () {
          const dishId = this.getAttribute('data-dish-id');
          const csrfToken = document.querySelector('input[name="csrfmiddlewaretoken"]').value;

          // Add item to bag (using fetch to make a POST request)
          fetch("{% url 'add_to_bag' %}", {
            method: 'POST',
            headers: {
              'X-CSRFToken': csrfToken,
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({
              dish_id: dishId,
              action: 'selected'
            })
          })
            .then(response => response.json())
            .then(data => {
              // Update the bag count
              document.querySelector('.bag-count').textContent = data.total_items_count;

              // Hide "Add to Bag" and show "Remove from Bag"
              button.style.display = 'none';
              const removeButton = document.querySelector(`.remove-from-bag[data-dish-id="${dishId}"]`);
              removeButton.style.display = 'inline-block';
            })
            .catch(error => console.error('Error:', error));
        });
      });

      // Remove from bag logic
      document.querySelectorAll('.remove-from-bag').forEach(button => {
        button.addEventListener('click', function () {
          const dishId = this.getAttribute('data-dish-id');
          const csrfToken = document.querySelector('input[name="csrfmiddlewaretoken"]').value;

          // Remove item from bag
          fetch("{% url 'add_to_bag' %}", {
            method: 'POST',
            headers: {
              'X-CSRFToken': csrfToken,
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({
              dish_id: dishId,
              action: 'unselected'
            })
          })
            .then(response => response.json())
            .then(data => {
              // Update the bag count
              document.querySelector('.bag-count').textContent = data.total_items_count;

              // Hide "Remove from Bag" and show "Add to Bag"
              button.style.display = 'none';
              const addButton = document.querySelector(`.add-to-bag[data-dish-id="${dishId}"]`);
              addButton.style.display = 'inline-block';
            })
            .catch(error => console.error('Error:', error));
        });
      });
    </script>



    <!-- <div class="container">
  <h1>Menu Items</h1>
  {% if error_message %}
      <p class="error">{{ error_message }}</p>
  {% endif %}

  <form method="post" action="{% if user.is_authenticated or user.is_staff %}{% url 'menu_items' %}{% else %}{% url 'log' %}{% endif %}">
      {% csrf_token %}
      
      
  <!<ul class="nav nav-tabs" id="myTab" role="tablist">
          {% for category in categories %}
              <li class="nav-item" role="presentation">
                  <a class="nav-link {% if forloop.first %}active{% endif %}" id="{{ category.name|slugify }}-tab" data-toggle="tab" href="#{{ category.name|slugify }}" role="tab"
                      aria-controls="{{ category.name|slugify }}" aria-selected="{% if forloop.first %}true{% else %}false{% endif %}">{{ category.name }}</a>
              </li>
          {% endfor %} -->
    <!-- </ul>  -->

    <!-- Tab panes -->
    <!-- <div class="tab-content mt-3">
          {% for category in categories %}
              <div class="tab-pane fade {% if forloop.first %}show active{% endif %}" id="{{ category.name|slugify }}" role="tabpanel" aria-labelledby="{{ category.name|slugify }}-tab">
                  {% if category.image %}
                      <img src="{{ category.image.url }}" alt="{{ category.name }}" class="category-image">
                  {% endif %}
                  <div class="menu-items">
                      {% for item in menu_items %}
                          {% if item.category.id == category.id %}
                              <div class="menu-item">
                                  {% if item.image %}
                                      <img src="{{ item.image.url }}" alt="{{ item.dish_name }}" class="item-image">
                                  {% else %}
                                      <img src="{% static 'placeholder-image.jpg' %}" alt="Placeholder" class="item-image">
                                  {% endif %}
                                  <input type="checkbox" name="menu_items" value="{{ item.id }}">
                                  <label>
                                      {% if item.dish_type == 'veg' %}
                                          <img src="{% static 'images/veg-icon.png' %}" alt="Veg" class="dish-type-icon">
                                      {% elif item.dish_type == 'non_veg' %}
                                          <img src="{% static 'images/non-veg.jpeg' %}" alt="Non-Veg" class="dish-type-icon">
                                      {% elif item.dish_type == 'green_leafy' %}
                                          <img src="{% static 'images/veg-icon.png' %}" alt="Green Leafy" class="dish-type-icon">
                                      {% endif %}
                                      {{ item.dish_name }} - ₹{{ item.price }}
                                      {% if item.recommended_dish %}
                                          <span class="recommended-text">Must-Try</span>
                                      {% endif %}
                                  </label>
                                  <input type="number" name="quantities" min="1" value="1" class="quantity">
                              </div>
                          {% endif %}
                      {% endfor %}
                  </div>
              </div>
          {% endfor %}
      </div>

      <button type="submit" class="order-button mt-3">Place Order</button>
  </form>
</div> -->

    <!-- Scripts -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

    <link rel="stylesheet" href="https://unpkg.com/swiper/swiper-bundle.min.css">
    <script src="https://cdn.jsdelivr.net/npm/swiper/swiper-bundle.min.js"></script>

    <script src="{% static 'bootstrap.bundle.min.js' %}"></script>
    <script src="{% static 'sidebars.js' %}"></script>

    <!-- Initialize Swiper -->
    <script>
      const swiper = new Swiper('.swiper-container', {
        speed: 1000,
        spaceBetween: 10, // Space between slides
        autoplay: {
          // delay: 6000, // Delay between automatic slide transitions
        },
        direction: 'horizontal',
        loop: true,
        slidesPerView: 3, // Show a maximum of 3 slides at a time
        breakpoints: {
          // Responsive breakpoints for different screen sizes
          320: {
            slidesPerView: 1, // Show 1 slide for small screens
            spaceBetween: 10
          },
          480: {
            slidesPerView: 2, // Show 2 slides for medium screens
            spaceBetween: 10
          },
          768: {
            slidesPerView: 3, // Show 3 slides for larger screens
            spaceBetween: 10
          },
          1024: {
            slidesPerView: 3, // Maximum of 3 slides, even for very large screens
            spaceBetween: 10
          }
        }
      });

      const events_swiper = new Swiper('.events-swiper-container', {
        speed: 6000,
        spaceBetween: 10, // Space between slides
        autoplay: {
          delay: 3000, // Delay between automatic slide transitions
        },
        direction: 'horizontal',
        loop: true,
        slidesPerView: 4, // Show a maximum of 3 slides at a time
        breakpoints: {
          // Responsive breakpoints for different screen sizes
          320: {
            slidesPerView: 1, // Show 1 slide for small screens
            spaceBetween: 10
          },
          480: {
            slidesPerView: 2, // Show 2 slides for medium screens
            spaceBetween: 10
          },
          768: {
            slidesPerView: 3, // Show 3 slides for larger screens
            spaceBetween: 10
          },
          1024: {
            slidesPerView: 4, // Maximum of 3 slides, even for very large screens
            spaceBetween: 10
          }
        }
      });

      // scripts.js

      function addItem(button) {
        const quantityController = button.parentNode;
        quantityController.innerHTML = `
        <button class="quantity-button" onclick="decreaseQuantity(this)">-</button>
        <span class="quantity-display">1</span>
        <button class="quantity-button" onclick="increaseQuantity(this)">+</button>
    `;
      }

      function increaseQuantity(button) {
        const quantityDisplay = button.previousElementSibling;
        let quantity = parseInt(quantityDisplay.innerText);
        quantity++;
        quantityDisplay.innerText = quantity;
      }

      function decreaseQuantity(button) {
        const quantityDisplay = button.nextElementSibling;
        let quantity = parseInt(quantityDisplay.innerText);
        if (quantity > 1) {
          quantity--;
          quantityDisplay.innerText = quantity;
        } else {
          const quantityController = button.parentNode;
          quantityController.innerHTML = `
            <button class="add-button" onclick="addItem(this)">Add</button>
        `;
        }
      }

      function placeOrder() {
        if (selectedItems.length === 0) {
          alert('Please select at least one item.');
          return;
        }

        // Prepare the data to send
        const formData = new FormData();
        formData.append('csrfmiddlewaretoken', '{{ csrf_token }}');

        selectedItems.forEach((item, index) => {
          formData.append(`menu_items[${index}]`, item.id);
          formData.append(`quantities[${index}]`, item.quantity);
        });

        fetch('{% url "menu_items" %}', {
          method: 'POST',
          body: formData,
        })
          .then(response => {
            if (response.ok) {
              window.location.href = '{% url "order_successful" %}';
            } else {
              alert('Failed to place order.');
            }
          })
          .catch(error => {
            console.error('Error:', error);
          });
      }

      document.querySelectorAll('.add-to-bag').forEach(button => {
        button.addEventListener('click', function () {
          const dishId = this.getAttribute('data-dish-id');
          const quantity = this.closest('.menu-item').querySelector('.quantity').value;

          fetch('{% url "add_to_bag" %}', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              'X-CSRFToken': '{{ csrf_token }}'
            },
            body: JSON.stringify({
              dish_id: dishId,
              quantity: quantity
            })
          })
            .then(response => response.json())
            .then(data => {
              // Update the bag count in the session dynamically
              document.querySelector('.bag-count').textContent = data.total_items_count;
            })
            .catch(error => console.error('Error:', error));
        });
      });


      // // Global array to hold selected items
      // let orderItems = [];

      // // Function to add an item to the order
      // function addItem(button) {
      //   // Get the menu item element
      //   const menuItem = button.closest('.menu-item');

      //   // Extract item details from data attributes
      //   const itemName = menuItem.getAttribute('data-name');
      //   const itemPrice = parseFloat(menuItem.getAttribute('data-price'));

      //   // Check if the item is already in the order
      //   const existingItem = orderItems.find(item => item.name === itemName);

      //   if (existingItem) {
      //     // If item is already in the order, increase the quantity
      //     existingItem.quantity++;
      //   } else {
      //     // If not, add a new item to the order
      //     orderItems.push({ name: itemName, price: itemPrice, quantity: 1 });
      //   }

      //   // Update the UI or log the order for now
      //   console.log(orderItems);
      // }

      // // Function to place the order
      // function placeOrder() {
      //   if (orderItems.length === 0) {
      //     alert('Your cart is empty. Please add items to your order.');
      //     return;
      //   }

      //   // Calculate total price
      //   let totalPrice = 0;
      //   orderItems.forEach(item => {
      //     totalPrice += item.price * item.quantity;
      //   });

      //   // Display order summary
      //   let orderSummary = 'Order Summary:\n';
      //   orderItems.forEach(item => {
      //     orderSummary += `${item.name} x ${item.quantity} - ₹${item.price * item.quantity}\n`;
      //   });
      //   orderSummary += `Total: ₹${totalPrice}`;

      //   // Display the order summary
      //   alert(orderSummary);

      //   // Here you can send the order to the server
      //   // e.g., using fetch or AJAX
      //   // Example:
      //   // fetch('/submit-order', {
      //   //     method: 'POST',
      //   //     headers: { 'Content-Type': 'application/json' },
      //   //     body: JSON.stringify(orderItems)
      //   // }).then(response => response.json()).then(data => {
      //   //     console.log('Order submitted successfully', data);
      //   // }).catch(error => {
      //   //     console.error('Error submitting order:', error);
      //   // });

      //   // Clear the order items after placing the order
      //   orderItems = [];
      // }


    </script>

    <!-- Footer -->
    <!-- <footer class="custom-footer">
      <div class="footer-content">
        <p>Copyright © 2024 MADHURAM KITCHENS - All Rights Reserved.</p>
        <div class="footer-links">
          <a href="#">Privacy Policy</a>
          <a href="#">Terms and Conditions</a>
        </div>
      </div>
    </footer> -->


<!-- scripts by ram -->
  <!-- loader -->
  <div id="ftco-loader" class="show fullscreen"><svg class="circular" width="48px" height="48px"><circle class="path-bg" cx="24" cy="24" r="22" fill="none" stroke-width="4" stroke="#eeeeee"/><circle class="path" cx="24" cy="24" r="22" fill="none" stroke-width="4" stroke-miterlimit="10" stroke="#F96D00"/></svg></div>


  <script src="{% static 'js/jquery.min.js' %}"></script>
  <script src="{% static 'js/jquery-migrate-3.0.1.min.js' %}"></script>
  <script src="{% static 'js/popper.min.js' %}"></script>
  <script src="{% static 'js/bootstrap.min.js' %}"></script>
  <script src="{% static 'js/jquery.easing.1.3.js' %}"></script>
  <script src="{% static 'js/jquery.waypoints.min.js' %}"></script>
  <script src="{% static 'js/jquery.stellar.min.js' %}"></script>
  <script src="{% static 'js/owl.carousel.min.js' %}"></script>
  <script src="{% static 'js/jquery.magnific-popup.min.js' %}"></script>
  <script src="{% static 'js/aos.js' %}"></script>
  <script src="{% static 'js/jquery.animateNumber.min.js' %}"></script>
  <script src="{% static 'js/bootstrap-datepicker.js' %}"></script>
  <script src="{% static 'js/jquery.timepicker.min.js' %}"></script>
  <script src="{% static 'js/scrollax.min.js' %}"></script>
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBVWaKrjvy3MaE7SQ74_uJiULgl1JY0H2s&sensor=false"></script>
  <script src="{% static 'js/google-map.js' %}"></script>
  <script src="{% static 'js/main.js' %}"></script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
{% endblock %}